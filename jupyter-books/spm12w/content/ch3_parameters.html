

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>SPM12w Parameter Files &#8212; SPM12w</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/ch3_parameters';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial Walkthrough" href="ch4_tutorial.html" />
    <link rel="prev" title="Preparing a study for SPM12w" href="ch2_prepare.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_spm12w.png" class="logo__image only-light" alt="SPM12w - Home"/>
    <script>document.write(`<img src="../_static/logo_spm12w.png" class="logo__image only-dark" alt="SPM12w - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to SPM12w
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch1_downloading.html">Downloading and Installing SPM12w</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch2_prepare.html">Preparing a study for SPM12w</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">SPM12w Parameter Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch4_tutorial.html">Tutorial Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch5_examples.html">Tutorial Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch6_tools.html">Additional Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch7_faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch8_changes.html">Change log</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fcontent/ch3_parameters.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/ch3_parameters.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>SPM12w Parameter Files</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-p-file">The p file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-glm-file">The glm file</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#glm-name-and-task-specification">GLM name and task specification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#glm-contrasts-specification">GLM contrasts specification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#glm-2nd-level-rfx-specification">GLM 2nd-level rfx specification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-glm-model-options-default-overrides">Additional GLM model options (default overrides)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-roi-file">The roi file</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="spm12w-parameter-files">
<h1>SPM12w Parameter Files<a class="headerlink" href="#spm12w-parameter-files" title="Permalink to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>Most functions in SPM12w are driven according to the parameters specified in their associated parameter file types (p,glm,roi,voi) which exist in the <em>derivatives/userID/code</em> directory. In this way, entire analyses (from preprocessing to group-level stats to ROI analyses) can be regenerated with minimal user input.</p>
</section>
<section id="the-p-file">
<h2>The p file<a class="headerlink" href="#the-p-file" title="Permalink to this heading">#</a></h2>
<p>The <strong>p</strong> parameter file is for preprocessing functional data. The file contains directory naming information along with various settings for preprocessing (e.g., EPI normalization vs. anatomy-based). Typically, we have only one <strong>p</strong> file per study/task, even though we may have multiple different <strong>glm</strong> parameter files.</p>
<p>Below we walk through the various lines of a parameters file.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% User name</span>
<span class="n">p</span><span class="p">.</span><span class="n">username</span> <span class="p">=</span> <span class="s">&#39;wagner.1174&#39;</span><span class="p">;</span>

<span class="c">% Derivative directory &amp; functional task specifications</span>
<span class="n">p</span><span class="p">.</span><span class="n">preproc_name</span> <span class="p">=</span> <span class="s">&#39;epinorm&#39;</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">task</span> <span class="p">=</span> <span class="s">&#39;tutorial&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>In this section, the username is provided along with a label to use in naming the derivative directory. Using these two elements, spm12w will create the following directory <em>derivatives/username/spm-preproc-epinorm</em> where the preprocessed data will be deposited.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The BIDS-compliant rawdata directory is never altered by spm12w. All preprocessing and analyses are stored in the derivatives directory. In this way, the derivatives directory can be deleted without affecting the bids-compliant dataset. Be careful to backup your code directory before doing this (or keep a copy of your code in the sourcedata/code directory).</p>
</div>
<p>The task variable allows spm12w to know what task(s) you want to preprocess. If you want to preprocess more than one task, place these in a cell array (i.e., <code class="docutils literal notranslate"><span class="pre">p.task</span> <span class="pre">=</span> <span class="pre">{'tutorial','motor'};</span></code>)</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% Preprocessing Routines - 1=yes 0=no</span>
<span class="n">p</span><span class="p">.</span><span class="n">unwarp</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c">% Unwarping (correct field inhomogeneties)</span>

<span class="n">p</span><span class="p">.</span><span class="n">normalize</span> <span class="p">=</span> ’<span class="n">epi</span>’<span class="p">;</span> <span class="c">% Normalize type (&#39;none&#39;,&#39;epi&#39;,&#39;spm12&#39;,&#39;dartel&#39;)</span>
<span class="n">p</span><span class="p">.</span><span class="n">smoothing</span> <span class="p">=</span> <span class="mi">8</span><span class="p">;</span>     <span class="c">% Size of smoothing kernel in FWHM (0 for no smoothing)</span>
</pre></div>
</div>
<p>In the section above we specify the preprocessing routines, beginning with SPM’s unwarping function (1 = yes, 0 = no), followed by the type of normalization (none, epi, spm12, or dartel) and smoothing kernel size.</p>
<p><em>Below, we describe each parameter in more detail:</em></p>
<dl class="simple myst">
<dt>p.username</dt><dd><p>Username used when forming directories for derivative data. This corresponds to the <em>./derivatives/username</em> directory. This allows multiple people to work from the same BIDS dataset by segregating their derivatives by user.</p>
</dd>
<dt>p.preproc-name</dt><dd><p>Name used in creating the path for the preprocessing derivatives.</p>
</dd>
<dt>p.task</dt><dd><p>Specifies which task(s) to run preprocessing on. For more than one task, place the tasks in a cell array of strings (i.e. {‘tutorial’,’motor’}).</p>
</dd>
<dt>p.unwarping</dt><dd><p>Specifies whether or not to run SPM’s unwarping routine. (1=yes, 0=no).</p>
</dd>
<dt>p.normalize</dt><dd><p>Specifies which normalization routine to use. ‘epi’ uses SPM’s epi template. ‘spm12’ uses SPM’s default anatomy-based normalization. ‘dartel’ is a placeholder for dartel-based normalization that we hope to implement in the future.</p>
</dd>
<dt>p.smoothing</dt><dd><p>Size of the smoothing kernel to use after normalization.</p>
</dd>
</dl>
<p>Less commonly used preprocessing options are available in the <em>spm12w_defaults.m</em> file.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is important not to edit this file as it will change the defaults for all users. If there is a default you want to override, copy it to your parameters file on an as-needed basis. If you override a default, spm12w will alert you during preprocessing.</p>
</div>
<p>The defaults in this fill allow you to disable slice time correction, and realignment, and turn off the QA options (e.g., shuffle check, SNR correction, etc.). In order to apply these, <strong>DO NOT EDIT THE DEFAULTS FILE</strong> but rather copy the variable from the <em>spm12w_defaults.m</em> file into your study’s <strong>P</strong> file. Make sure to change the structure name (i.e., from <em>def.(fieldname)</em> to <em>p.(fieldname)</em>). This will override the associated default only for that preprocessing instance.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will know that this is working as spm12w will announce the override as it begins preprocessing. If you do not see the override warning message, then something has gone amiss.</p>
</div>
</section>
<section id="the-glm-file">
<h2>The glm file<a class="headerlink" href="#the-glm-file" title="Permalink to this heading">#</a></h2>
<p>The glm file contains parameters specifying first-level GLMs and their contrasts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each GLM file specifies a single GLM. If you wish to model your task different, or model a different task collected in the same session, you will need to make a new GLM. It is not uncommon for a single study to have more than one GLM file.</p>
</div>
<section id="glm-name-and-task-specification">
<h3>GLM name and task specification<a class="headerlink" href="#glm-name-and-task-specification" title="Permalink to this heading">#</a></h3>
<p>The section below specifies what preprocessing data to use for modeling, the glm name, and the task to be modelled.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% User name</span>
<span class="n">glm</span><span class="p">.</span><span class="n">username</span> <span class="p">=</span> <span class="s">&#39;wagner.1174&#39;</span><span class="p">;</span>

<span class="c">% Directory &amp; functional task specifications</span>
<span class="n">glm</span><span class="p">.</span><span class="n">preproc_name</span> <span class="p">=</span> <span class="s">&#39;epinorm&#39;</span><span class="p">;</span>
<span class="n">glm</span><span class="p">.</span><span class="n">glm_name</span> <span class="p">=</span> <span class="s">&#39;glm_tutorial&#39;</span><span class="p">;</span>
<span class="n">glm</span><span class="p">.</span><span class="n">task</span> <span class="p">=</span> <span class="s">&#39;tutorial&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Like in the preprocessing file (i.e., the <strong>p</strong> file), we begin by specifying the user. In this manner all derivatives (i.e., preprocessing , glm models, etc.) are seperated by user. In the following section, we specify the name of the preprocessing corresponding to the <strong>p.preproc_name</strong>  in the <strong>p</strong> file).</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have more than one preprocessing for a given study (e.g., with and without smoothing), you can create a GLM for each preprocessing and specify the name of the preprocessing you’d like to model in the <strong>glm.preproc_name</strong>.</p>
</div>
<p>Next, we specify the name of the glm which will be used to construct the derivative directory where the results will be stored. Finally, we specify the task to model. Unlike preprocessing, you can only model one task per glm file.</p>
<p>Unlike in past versions of spm12w, we no longer need to specify an onset directory as all the appropriate task onset parameters are pulled from the associated BIDS task <em>events.tsv</em> file.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% GLM conditions corresponding to trial_type column in the events.tsv</span>
<span class="n">glm</span><span class="p">.</span><span class="k">events</span>     <span class="p">=</span> <span class="p">{</span><span class="s">&#39;human&#39;</span><span class="p">,</span><span class="s">&#39;animal&#39;</span><span class="p">,</span><span class="s">&#39;vegetable&#39;</span><span class="p">,</span><span class="s">&#39;mineral&#39;</span><span class="p">};</span>
<span class="n">glm</span><span class="p">.</span><span class="n">blocks</span>     <span class="p">=</span> <span class="p">{};</span>
<span class="n">glm</span><span class="p">.</span><span class="n">regressors</span> <span class="p">=</span> <span class="p">{};</span>
</pre></div>
</div>
<p>In this section, we specify whether we wish to model events, blocks or regessors. For standard event-related designs, specify the BIDS <strong>trial_type</strong> labels inside the cell array, these should match the entries in the associated BIDS <em>events.tsv</em> file. The same is also true of Block designs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to specify more than one type of event to model, for instance state-item designs would contain botch events and blocks, whereas PPI models would contain both events and regressors.</p>
</div>
</section>
<section id="glm-contrasts-specification">
<h3>GLM contrasts specification<a class="headerlink" href="#glm-contrasts-specification" title="Permalink to this heading">#</a></h3>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% GLM Contrasts - Numeric contrasts should sum to zero unless vs. baseline</span>
<span class="c">%               - String contrasts must match condition names.</span>
<span class="c">%               - String contrast direction determined by the placement of &#39;vs.&#39;</span>
<span class="c">%               - Special keywords: &#39;housewine&#39; | &#39;fir_bins&#39; | &#39;fir_hrf&#39;</span>
<span class="c">% Note that the housewine&#39;s allVSbaseline will skip pmods but is not savy</span>
<span class="c">% to complex designs (i.e., where you want all conditions VS baseline but</span>
<span class="c">% not your user supplied regressors under glm.regressors, so in those cases</span>
<span class="c">% you should create your own allVSbaseline and refuse the housewine). </span>
<span class="n">glm</span><span class="p">.</span><span class="n">con</span><span class="p">.</span><span class="n">housewine</span> <span class="p">=</span> <span class="s">&#39;housewine&#39;</span><span class="p">;</span>
<span class="n">glm</span><span class="p">.</span><span class="n">con</span><span class="p">.</span><span class="n">humVSveg</span>  <span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">0</span><span class="p">];</span> 
<span class="n">glm</span><span class="p">.</span><span class="n">con</span><span class="p">.</span><span class="n">aniVSmin</span>  <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<span class="n">glm</span><span class="p">.</span><span class="n">con</span><span class="p">.</span><span class="n">minANDhum</span> <span class="p">=</span> <span class="s">&#39;mineral human&#39;</span><span class="p">;</span> 
<span class="n">glm</span><span class="p">.</span><span class="n">con</span><span class="p">.</span><span class="n">humVSall</span>  <span class="p">=</span> <span class="s">&#39;human vs. animal vegetable mineral&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>The first contrast in the example above specfied the “housewine” contrast, this is a special keyword that will automatically generate several commonly used contrasts (e.g., all conditions vs. baseline as well as seperate contrasts for each condition vs. baseline). Users should feel free to refuse the housewine if you do not want these contrasts.</p>
<p>The next set of contrasts set numeric and string-based contrasts. spm12w allows for both types of contrasts as well as mixing and matching. For string-based contrasts the labels must match those in the BIDS task-events.tsv <strong>trial_type</strong> column. In addition, <em>‘vs.’</em>
is a special keyword that spm12w will use to convert the string contrast into a numeric one. The resulting numeric contrast will be shown in the command window during contrast computing.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For numeric contrasts it is not necessary to specify trailing zeros (spm12w will pad the remaining contrast vector with the appropriate zeros).</p>
</div>
</section>
<section id="glm-2nd-level-rfx-specification">
<h3>GLM 2nd-level rfx specification<a class="headerlink" href="#glm-2nd-level-rfx-specification" title="Permalink to this heading">#</a></h3>
<p>The final section of the GLM consists of two variables related to the 2nd-level random effects analysis. The first specifies the name of the 2nd-level model and the second describes the contrasts to model.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% RFX (2nd-level) specifications</span>
<span class="c">% The assignments below will run seperate random effects one-sample t-tests</span>
<span class="c">% on the conditions allVSbaseline and humVSall.</span>
<span class="n">glm</span><span class="p">.</span><span class="n">rfx_name</span> <span class="p">=</span> <span class="s">&#39;rfx_tutorial&#39;</span><span class="p">;</span>
<span class="n">glm</span><span class="p">.</span><span class="n">rfx_conds</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;allVSbaseline&#39;</span><span class="p">,</span><span class="s">&#39;humVSall&#39;</span><span class="p">};</span>
</pre></div>
</div>
<p>It is also possible to conduct a one-way ANOVA across conditions at the 2nd-level. For this, you need to override the default glm.rfx_type by including the variable below in your GLM file. SPM12w will take care of setting the appropriate subject-level regressors.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">glm</span><span class="p">.</span><span class="n">rfx_type</span>  <span class="p">=</span> <span class="s">&#39;anova1&#39;</span><span class="p">;</span> <span class="c">% Normally we don&#39;t include type as we usually do </span>
                          <span class="c">% one-sample and that&#39;s the default. Here we have to </span>
                          <span class="c">% explicitly specify the type.</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Setting the GLM rfx_type to anova1 will conduct an anove across the conditions specified in the glm.rfx_conds variable. If you want to also conduct regular one-sample t-test across conditions, you will need to specify these in a seperate GLM file.</p>
</div>
</section>
<section id="additional-glm-model-options-default-overrides">
<h3>Additional GLM model options (default overrides)<a class="headerlink" href="#additional-glm-model-options-default-overrides" title="Permalink to this heading">#</a></h3>
<p>As with preprocessing, there are many more options available for GLM estimation. These can be found in the <em>spm12w_defaults.m</em> file. Below is an example of several of these addition options.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% GLM Model Specifications</span>
<span class="n">def</span><span class="p">.</span><span class="n">parametrics</span> <span class="p">=</span> <span class="p">{};</span>    <span class="c">% placeholder for parametrics in case user does not specify</span>
<span class="n">def</span><span class="p">.</span><span class="n">runsplit</span>    <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>     <span class="c">% Seperate GLM per run? Useful for MVPA (%TODO: NOT YET IMPLEMENTED)</span>
<span class="n">def</span><span class="p">.</span><span class="n">design_only</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>     <span class="c">% Design only (i.e., no data)</span>
<span class="n">def</span><span class="p">.</span><span class="n">include_run</span> <span class="p">=</span> <span class="s">&#39;all&#39;</span><span class="p">;</span> <span class="c">% Specify run to model: &#39;all&#39; or runs (e.g. [1,3,5])</span>
<span class="n">def</span><span class="p">.</span><span class="n">duration</span>    <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>     <span class="c">% Event/Block Duration in seconds. Will override the durations in the</span>
                         <span class="c">% task event.tsv files. </span>
<span class="n">def</span><span class="p">.</span><span class="n">block_conv</span>  <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>     <span class="c">% Convolve blocks (0 for state/item) - 1=yes 0=no</span>
<span class="n">def</span><span class="p">.</span><span class="n">polort</span>      <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>     <span class="c">% Order of polynomials: 0:Const|1:Linear|2:Quad|3:Cubic</span>
<span class="n">def</span><span class="p">.</span><span class="n">outliers</span>    <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>     <span class="c">% Include outlier scans as nuissance? (use spm12w_art.m)</span>
<span class="n">def</span><span class="p">.</span><span class="n">move</span>        <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>     <span class="c">% Include motion regressors?</span>
<span class="n">def</span><span class="p">.</span><span class="n">trends</span>      <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>     <span class="c">% Include polynomial trends as nuissance</span>
<span class="n">def</span><span class="p">.</span><span class="n">constants</span>   <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>     <span class="c">% Include n-1 run constants in model for concatenation</span>

<span class="c">% GLM Model Defaults</span>
<span class="n">def</span><span class="p">.</span><span class="n">trialtype</span>  <span class="p">=</span> <span class="s">&#39;trial_type&#39;</span> <span class="p">;</span> <span class="c">% BIDS column to use for conditions (default: &#39;trial_type&#39;)</span>
<span class="n">def</span><span class="p">.</span><span class="nb">time</span>       <span class="p">=</span> <span class="s">&#39;secs&#39;</span><span class="p">;</span>  <span class="c">% Onsets specified in &#39;scans&#39; or &#39;secs&#39; Always secs due to bids.</span>
<span class="n">def</span><span class="p">.</span><span class="n">hpf</span>        <span class="p">=</span> <span class="nb">Inf</span><span class="p">;</span>     <span class="c">% HPF inf=no cutoff|otherwise cutoff in secs i.e. 128)                               </span>
<span class="n">def</span><span class="p">.</span><span class="n">autocorr</span>   <span class="p">=</span> <span class="s">&#39;none&#39;</span><span class="p">;</span>  <span class="c">% Autocorrelation correction (none | &#39;AR(1)&#39;)                                   </span>
<span class="n">def</span><span class="p">.</span><span class="n">demean</span>     <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="c">% Demean condition regressors as in SPM99?</span>
<span class="n">def</span><span class="p">.</span><span class="nb">orth</span>       <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>       <span class="c">% Disable w/i trial orth (0) or enable it (1, SPM default) </span>
<span class="n">def</span><span class="p">.</span><span class="n">writeresid</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="c">% Write residual images during GLM modeling (0, SPM default)</span>
<span class="n">def</span><span class="p">.</span><span class="n">residname</span>  <span class="p">=</span> <span class="s">&#39;glm_residuals.nii&#39;</span><span class="p">;</span> <span class="c">% 4D residuals filename if writeresid = 1</span>

<span class="c">% GLM HRF Specifications:</span>
<span class="c">% OPTIONS:&#39;hrf&#39;</span>
<span class="c">%         &#39;hrf (with time derivative)&#39;</span>
<span class="c">%         &#39;hrf (with time and dispersion derivatives)&#39;</span>
<span class="c">%         &#39;Fourier set&#39;</span>
<span class="c">%         &#39;Fourier set (Hanning)&#39;</span>
<span class="c">%         &#39;Gamma functions&#39;</span>
<span class="c">%         &#39;Finite Impulse Response&#39;</span>
<span class="n">def</span><span class="p">.</span><span class="n">hrf</span>       <span class="p">=</span> <span class="s">&#39;hrf&#39;</span><span class="p">;</span>  <span class="c">%Set to Finite Impulse Response for MIXED designs.</span>
<span class="n">def</span><span class="p">.</span><span class="n">hrfwindow</span> <span class="p">=</span> <span class="mi">20</span><span class="p">;</span>     <span class="c">%For FIR: Length of HRF window </span>
<span class="n">def</span><span class="p">.</span><span class="n">hrfbasis</span>  <span class="p">=</span> <span class="mi">8</span><span class="p">;</span>      <span class="c">%For FIR: Number of bins per window</span>

<span class="c">% GLM microtime speifications: </span>
<span class="n">def</span><span class="p">.</span><span class="n">tbins</span>     <span class="p">=</span> <span class="mi">16</span><span class="p">;</span> <span class="c">% Time bin resolution for each scan (16, SPM default)</span>
<span class="n">def</span><span class="p">.</span><span class="n">tref</span>      <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c">% Reference time bin for GLM. Usually timebin corresponding </span>
                    <span class="c">% to the ref slice during slicetime correction. For Philips</span>
                    <span class="c">% interleaved the first slice acquired is slice 1 so the</span>
                    <span class="c">% the reference timebin is also 1 if p.refslice=1. </span>
</pre></div>
</div>
<dl class="simple myst">
<dt>glm.parametrics</dt><dd><p>Specifies the parametric</p>
</dd>
<dt>glm.include_run</dt><dd><p>This setting determines which runs (i.e., sessions) will be modeled. Options are ‘all’ for all sessions. A single number for only one run (e.g., <code class="docutils literal notranslate"><span class="pre">glm.include_run</span> <span class="pre">=</span> <span class="pre">2;</span></code>) or a vector of runs (e.g., <code class="docutils literal notranslate"><span class="pre">glm.include_run</span> <span class="pre">=</span> <span class="pre">[1,3];</span></code>)</p>
</dd>
</dl>
<p>glm.polyord</p>
<p>\item[include_run:] This setting determines which run (i.e., session) will be modeled. Options are ‘all’ for all sessions. A single number for only one run (e.g., p.include_run = 2;) or a vector of runs (.e.g, p.include_run = [1,3];)
\item[p.polyord:] Number of polynomials to detrend with. Typically we use p.polyord = 1 which is equivalent to a linear trend + constant (i.e., our old linear trend regressor in prior versions of SPM12). However it is possible to include more polynomials, which may be useful for detrending longer runs.
\item[p.move:] Enables or disables inclusion of motion regressors. Under cases of very small motion, it may be advisable to not model motion at all.
\item[p.outliers:] Enables inclusion of dummy regressors for outlier volumes as calculated by art-_detect (run using SPM12_art.m). There is no harm to leaving this on, as if no files detailing which scans are outliers are found, then GLM computation will proceed. In this way it’s possibly to only model outliers for subjects who have files describing which scans are outliers.
\item[p.demean:] Optional setting to demean task regressors prior to GLM computation. This was the default behavior in SPM99 but, as far as I can tell, was accidentally left out of SPM2 and never repaired as it has no effect on beta estimates. Will Penny from the spm list: \textit{“SPM2 doesn’t mean centre regressors whereas SPM99 did. It is an inconsistency but not one of great import as it will have no effect on the parameter estimates or resulting inference (it will change the estimate of the constant term but nothing else).”} It does, however, result in SPM orthogonality checks which are difficult to interpret. Turning this on should have no effect on results, but make SPM’s default orthogonality check easier to interpret.
\item[p.durtime:] Durations are expressed in seconds or TRs. If durations are in seconds (e.g. reaction times), SPM12 will convert them to TRs. This works for block and event-related designs but if you use this all durations must be in seconds (e.g. both the states and items in a state-item design). SPM12 will always warn you during estimation if it divides by TR.
\item[p.disable_orth:] SPM’s within trial type orthogonalization is disabled. SPM defaults to orthogonalizing within trial regressors (i.e., successive parametric regressors or successive FIR regressors). This option allows you to disable this behavior. At present it strikes us as undesirable to orthogonalize FIR regressors. Importantly, this variable expects that you have replaced the stock spm_fMRI_design.m file with the modified spm_fMRI_design.m file that can be found in SPM12’s ADDITIONAL_FILES directory.
\end{description}</p>
<p>The following section details some of the advanced settings for HRF modeling, filtering and realignment.</p>
<p>\begin{description}
\item[p.hrf:] Specifies which model of the HRF to use.
\item[p.hrfwindow:] For FIR designs: Duration (window) of modeled HRF. Needs to be approximately 20 seconds to capture the full HRF.
\item[p.hrfbasis:] For FIR designs: Number of basis sets with which to model the HRF. Should be an integer (preferably p.hrfwindow / TR). So for a 20 second window, with a TR of 2.5, p.hrfbasis would be 8 (i.e. 8 time bins of 2.5s).
\item[p.hpf and p.autocorr:] Additional options include high pass filtering and serial autocorrelation correction. These should only be used if you have a single run of data and are feeling adventurous. Although, according to Darren Gitelmen at an MGH workshop, it is not quite a cardinal sin to run HPF and autorcorrelation correction on concatenated runs, but nevertheless this has not been our convention.
\item[p.refslice and p.realign_rtm:] Specifies which slice to use as reference slice for slicetime correction and whether realignment should take place relative to the 1st slice (1pass) or if realignment should use a 2pass solution realigning to the 1st run then to the session mean. In general we always use slice 1, but this can vary depending on acquisition sequence.
\item[p.overridedel:] If set to 0, SPM12 will always ask if you wish to delete prior analyses before overwriting them (i.e., when redoing preprocessing or GLM computation). The reasoning for this setting is to ensure that analysis directories remain free of clutter from prior analyses, SPM12 will typically delete the entire FUNCTIONAL directory (saving only outlier files) and check out fresh copies from the NIFTI directory. If you decide to store your diary and personal photographs inside a subject’s FUNCTIONAL or ANATOMICAL directory, you will lose them. p.overridedel = 0 will cause SPM12 to ask you for confirmation prior to deleting prior data directories. Although, this may seem desirable it requires you to answer this question for every subject.
\end{description}</p>
<p>There are some additionally settings in the P file no discussed here. To find out more, read the comments in the P files provided with the example dataset.</p>
<p>\subsection{The CON file}
The study contrasts file specifies the type of contrast to perform on the conditions from the GLM. Contrasts are zero padded to fill in nuisance regressors. This is especially useful in situations where the number of regressors in the model differs per subject (e.g. if p.outliers = 1) or for mixed designs and FIR models where the number of regressors can easily reach 100 (see CON_H8TJAZZ_MIXED.m for an example of some tricks for making organized contrast vectors for a state-item study). The way this works is that SPM12 will searche through the regressor names and count the number of ‘r’ regressors (which is the name we reserve for nuisance regressors). It is therefore important to keep in mind that this ‘trick’ will fail if you hack in any custom nuisance regressors and don’t name them ‘r’. If you let SPM12 make the nuisance regressors for you, then this should always be correct.</p>
<p>Protip: ensure that your contrast vectors always sum to zero (except for vs. baseline) and that your contrast weights never exceed one. For instance, [3 -1 -1 -1] while a valid contrast that will generate an appropriate statistical map, the underlying beta values are multiplied by the contrast weights. Thus, when you go to extract con values for an ROI analysis, the values will be scaled by the weights. All statistics on such values will be valid, but when you go to plot the results, the y-axis may appear to be overly large!</p>
</section>
</section>
<section id="the-roi-file">
<h2>The roi file<a class="headerlink" href="#the-roi-file" title="Permalink to this heading">#</a></h2>
<p>The <strong>roi</strong> parameters file specifies how to run the ROI analyses using spm12w’s roitool (i.e., <code class="docutils literal notranslate"><span class="pre">spm12w_roitool.m</span></code>). This file is used to determine what type (image mask or spherical) of ROI to generate, what model to grab the parameter estiamtes from and what statistics to conduct (e.g., descriptives, t-tests, correlations).</p>
<p>The following section of the ROI parameter file specifies where the ROI analysis results will be written (roi_dir) which RFX directory contains the con images (rfx_dir). The optional location of the directory containing a priori ROIs (i.e., anatomical or some other source; roi_img_dir). And finally the filename of excel spreadsheet files containing roi specifications and subject variables (see the xlsx files provided with the example dataset to understand the layout). Note that the roi_spec_file is optional. ROI specifications can also be defined in a variable (see below) and will be used if the roi_spec_file does not exist.</p>
<p>This section describes the conditions from which the parameter estimates will be extracted. These conditions must match those in the CON parameter file that is associated with this particular RFX analysis. Put differently, SPM12_roitool.m will extract parameter estimates from files in the RFX/RFX_H8TJAZZ/humVSbas directory (and so forth).</p>
<p>This section defines the roi specs requiring a region name, an MNI coordinate and a size in mm’s (for spherical ROIs). If a filename is provided instead of an ROI size then SPM12_roitool will search for this file in the roi_img_dir specified earlier. Finally, if a roi spec excel file was specified and exists, this r.roi_specs variable will be ignored.</p>
<p>This section describes the statistics that will be performed on the parameter estimates extracted from for each condition. Condition names can be used to construct formulae for analysis (i.e. ‘vegVSbas-minVSbas’) which SPM12_roitool will interpret appropriately. If ‘all_conditions’ is written instead, then SPM12_roitool will perform the defined statistic on all conditions in r.conditions.
For correl and t-test2, SPM12_roitool requires a subject variables excel file defining group membership and, for each subject, a value for one or more variables to use in correlation analyses.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ch2_prepare.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Preparing a study for SPM12w</p>
      </div>
    </a>
    <a class="right-next"
       href="ch4_tutorial.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tutorial Walkthrough</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-p-file">The p file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-glm-file">The glm file</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#glm-name-and-task-specification">GLM name and task specification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#glm-contrasts-specification">GLM contrasts specification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#glm-2nd-level-rfx-specification">GLM 2nd-level rfx specification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-glm-model-options-default-overrides">Additional GLM model options (default overrides)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-roi-file">The roi file</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dylan D. Wagner
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>