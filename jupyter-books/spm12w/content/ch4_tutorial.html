

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Tutorial Walkthrough &#8212; SPM12w</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/ch4_tutorial';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial Walkthrough" href="ch5_examples.html" />
    <link rel="prev" title="SPM12w Parameter Files" href="ch3_parameters.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_spm12w.png" class="logo__image only-light" alt="SPM12w - Home"/>
    <script>document.write(`<img src="../_static/logo_spm12w.png" class="logo__image only-dark" alt="SPM12w - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to SPM12w
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch1_downloading.html">Downloading and Installing SPM12w</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch2_prepare.html">Preparing a study for SPM12w</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch3_parameters.html">SPM12w Parameter Files</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Tutorial Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch5_examples.html">Tutorial Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch6_tools.html">Additional Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch7_faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch8_changes.html">Change log</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fcontent/ch4_tutorial.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/ch4_tutorial.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Tutorial Walkthrough</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-spm12w-tutorial-dataset">The SPM12w tutorial dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-conversion-from-par-rec">Step 1: Conversion from par/rec</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-prepare-data-and-generate-tsvfiles">Step 2: Prepare data and generate tsvfiles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-validate-the-bids-structure-with-the-bids-validator">Step 3: Validate the BIDS structure with the BIDS validator.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-preprocess-the-fmri-data">Step 4: Preprocess the fMRI data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-estimate-glms">Step 5: Estimate GLMs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-compute-contrasts">Step 6: Compute Contrasts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-7-random-effects-analysis">Step 7: Random Effects Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-8-region-of-interest-roi-analysis">Step 8: Region-of-Interest (ROI) Analysis</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="tutorial-walkthrough">
<h1>Tutorial Walkthrough<a class="headerlink" href="#tutorial-walkthrough" title="Permalink to this heading">#</a></h1>
<section id="the-spm12w-tutorial-dataset">
<h2>The SPM12w tutorial dataset<a class="headerlink" href="#the-spm12w-tutorial-dataset" title="Permalink to this heading">#</a></h2>
<p>The Tutorial Dataset consists of three subjects with two runs of functional data and a defaced anatomy file for each participant. These data are shared with permission. The data consist of two runs of resting-state data, but for the purpooses of the tutorial we will treat this as functional data. Don’t be suprised if the results are meaningless, there is no task to model. We’re simply using this data to demonstrate how to run different models.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Whenever you are using spm12w, make sure Matlab is in the root directory of your study. In this cast that would be <strong>spm12w_tutorial_data_bids</strong>.</p>
</div>
</section>
<section id="step-1-conversion-from-par-rec">
<h2>Step 1: Conversion from par/rec<a class="headerlink" href="#step-1-conversion-from-par-rec" title="Permalink to this heading">#</a></h2>
<p>The first step of running the tutorial data through its paces is to covnert that data from par/rec format to BIDS nifti files using <strong>spm12w_prepare.m</strong></p>
<p>Although <strong>spm12w_prepare.m</strong> has a number of options (see help), for the tutorial we will run it with only the <em>bidsgui</em> argument which forces a gui to open so we can fix naming issues during the conversion to BIDS.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">spm12w_prepare</span><span class="p">(</span><span class="s">&#39;bidsgui&#39;</span><span class="p">,</span> <span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
<p>This will open up a window allowing you to select archive files located in the <em>./sourcedata/parrec</em> directory. To continue, select all three <em>parrec_tutorial0?_900?DW_13feb01_s999?.zip</em> files and click <strong>open</strong>.</p>
<p>The next window will show two data series, these should be renamed to BIDS spec as in the image below. No other field needs to be altered This needs to be repeated for each of the three datasets.</p>
<figure class="align-default" id="ch4-prepare">
<a class="reference internal image-reference" href="../_images/ch4_prepare.png"><img alt="../_images/ch4_prepare.png" src="../_images/ch4_prepare.png" style="width: 550px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text">spm12w_prepare: Type and modaily settings for the tutorial dataset.</span><a class="headerlink" href="#ch4-prepare" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="step-2-prepare-data-and-generate-tsvfiles">
<h2>Step 2: Prepare data and generate tsvfiles<a class="headerlink" href="#step-2-prepare-data-and-generate-tsvfiles" title="Permalink to this heading">#</a></h2>
<p>The next step for the tutorial dataset is to run two matlab files, the first will extract the anatomical MRI files and place them in the appropriate locations and the second will fix the json files generated during BIDS conversion for a small innacuracy in the TR.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The two steps below are only specific to the tutorial dataset. You will not have to do this on your own data. The tutorial dataset was collected a long time ago and the par/rec fields had some innacuracies in them. In addition, the need to manually copy to anatomy is due to the fact that these were defaced following conversion for anonimity and thus we cannot provide the raw par/rec files.</p>
</div>
<p>To run these scripts, type the following commands at the matlab prompt.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">run</span><span class="p">(</span><span class="s">&#39;./sourcedata/code/anat_fixer.m&#39;</span><span class="p">)</span>
<span class="nb">run</span><span class="p">(</span><span class="s">&#39;./sourcedata/code/json_fixer.m&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The next step is to generate the tsv and json sidecars for the task (<strong>task-tutorial_events.tsv</strong>) and for the participants (<strong>participants.tsv</strong>). The tutorial data contains <em>.csv</em> files that contain all the necessary data to generate the task and participants <em>.tsv</em> files.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You may want to inspect these files to understand how to generate task and participant files for your own studies.</p>
</div>
<p>To run these scripts, type the following commands at the matlab prompt.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">spm12w_tsvmaker</span><span class="p">(</span><span class="s">&#39;sids&#39;</span><span class="p">,{</span><span class="s">&#39;sub-tutorial01&#39;</span><span class="p">,</span><span class="s">&#39;sub-tutorial02&#39;</span><span class="p">,</span><span class="s">&#39;sub-tutorial03&#39;</span><span class="p">},</span> <span class="p">...</span>
               <span class="s">&#39;csvfile&#39;</span><span class="p">,</span> <span class="s">&#39;./sourcedata/tsvfiles/task-tutorial_events_tsv.csv&#39;</span><span class="p">);</span>
<span class="n">spm12w_tsvmaker</span><span class="p">(</span><span class="s">&#39;sids&#39;</span><span class="p">,{</span><span class="s">&#39;sub-tutorial01&#39;</span><span class="p">,</span><span class="s">&#39;sub-tutorial02&#39;</span><span class="p">,</span><span class="s">&#39;sub-tutorial03&#39;</span><span class="p">},</span> <span class="p">...</span>
               <span class="s">&#39;csvfile&#39;</span><span class="p">,</span> <span class="s">&#39;./sourcedata/tsvfiles/participants_tsv.csv&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The output should look similar to this:</p>
<figure class="align-default" id="ch4-tsvmaker">
<a class="reference internal image-reference" href="../_images/ch4_tsvmaker.png"><img alt="../_images/ch4_tsvmaker.png" src="../_images/ch4_tsvmaker.png" style="width: 550px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">spm12w_tsvmaker: Output after making tsv files for task and participants.</span><a class="headerlink" href="#ch4-tsvmaker" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="step-3-validate-the-bids-structure-with-the-bids-validator">
<h2>Step 3: Validate the BIDS structure with the BIDS validator.<a class="headerlink" href="#step-3-validate-the-bids-structure-with-the-bids-validator" title="Permalink to this heading">#</a></h2>
<p>After preparing the data and generating the BIDS tsv files, you should use the <a class="reference external" href="https://bids-standard.github.io/bids-validator/">online BIDS validator tool</a> to ensure the study conforms to the BIDS spec.</p>
<p>The BIDS validator expects that you select the directory containing the BIDS dataset without derivatives and sourcedata. In our case, that corresponds to the <strong>rawdata</strong> directory of the tutorial dataset. After selecting the <strong>rawdata</strong>, the output of the BIDS validator webpage should look similar to this:</p>
<figure class="align-default" id="ch4-validate">
<a class="reference internal image-reference" href="../_images/ch4_validator.png"><img alt="../_images/ch4_validator.png" src="../_images/ch4_validator.png" style="width: 550px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">BIDS validator: Output of the online BIDS validator tool.</span><a class="headerlink" href="#ch4-validate" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>You may see a warning that there are too few authors, this is because the BIDS spec doesn’t believe it’s possible for a dataset to have only one author!</p>
</section>
<section id="step-4-preprocess-the-fmri-data">
<h2>Step 4: Preprocess the fMRI data<a class="headerlink" href="#step-4-preprocess-the-fmri-data" title="Permalink to this heading">#</a></h2>
<p>The next step is to perform fMRI preprocess on the tutorial dataset. For this we will use the spm12w GUI.</p>
<p>Begin by typing <code class="docutils literal notranslate"><span class="pre">spm12w</span></code> in the Matlab command window. You should see the SPM12w GUI appear.</p>
<figure class="align-default" id="ch4-gui">
<a class="reference internal image-reference" href="../_images/ch_spm12w_gui.png"><img alt="../_images/ch_spm12w_gui.png" src="../_images/ch_spm12w_gui.png" style="width: 550px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">SPM12w GUI: The SPM12w GUI allows easy access to most spm12w functions.</span><a class="headerlink" href="#ch4-gui" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Next, we’re going to preprocess all three subjects but as preprocessing is the longest step of fMRI analysis, we will run it in parallel using the Matlab Parallel Computing Toolbox.</p>
<p>Before pressing the Preprocess button, turn on parallel processing (i.e., <strong>[ON] Parallel</strong>) and then select 3 CPU cores and click the set button. You should see the following on the command prompt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">06</span><span class="o">/</span><span class="mi">14</span><span class="o">/</span><span class="mi">2024</span> <span class="mi">16</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">27</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="n">Parallel</span> <span class="n">processing</span> <span class="ow">is</span> <span class="p">[</span><span class="n">ON</span><span class="p">]</span>
<span class="mi">06</span><span class="o">/</span><span class="mi">14</span><span class="o">/</span><span class="mi">2024</span> <span class="mi">16</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">30</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="n">Parallel</span> <span class="n">processing</span> <span class="nb">set</span> <span class="n">to</span> <span class="mi">3</span> <span class="n">cores</span><span class="o">...</span>
</pre></div>
</div>
<p>Next, click the preprocess button and select all three tutorial participants. Click <strong>done</strong> when finished.</p>
<figure class="align-default" id="ch4-select">
<a class="reference internal image-reference" href="../_images/ch4_prepselect.png"><img alt="../_images/ch4_prepselect.png" src="../_images/ch4_prepselect.png" style="width: 550px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">The first three tutorial subjects are selected.</span><a class="headerlink" href="#ch4-select" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Finally, you must provide a parameters file that specifies the preprocessing parameters (See Ch3_parameters) for more information. The tutorial dataset comes with two files:</p>
<ol class="arabic simple">
<li><p><strong>p_tutorial.m</strong>: Preprocessing and normalizing to MNI using the EPI template.</p></li>
<li><p><strong>p_tutorial_spm12norm.m</strong>: Preprocessing and normalizing to MNI using the Anatomical file.</p></li>
</ol>
<p>For this walkthrough we will use the <strong>p_tutorial.m</strong> file. Select that and hit done. Preprocessing will begin.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>SPM12w will write a lot of details to the Matlab command window. It is advisable to monitor these the first time you preprocess a study in order to find any mistakes. In particular, pay attention to the <em>Slice time acquisition timing</em> the <em>number of runs</em> and the <em>number of vols</em> to ensure these look as expected.</p>
</div>
<p>After preprocessing, the following log files and QA files are created:</p>
<ul class="simple">
<li><p>epinorm.log: A logfile of everything that was printed to the Matlab command window.</p></li>
<li><p>sub-tutorial0?_epinorm.pdf: A PDF of all the figures and spm12w specific QA generated during preprocesing.</p></li>
<li><p>general qa image files: Mean, Stdev and temporal SNR nifti files for each preprocessed run.</p></li>
</ul>
<p>The location of these files is printed to the command window after processing is complete. See below for an example.</p>
<figure class="align-default" id="ch4-logfiles">
<a class="reference internal image-reference" href="../_images/ch4_logfiles.png"><img alt="../_images/ch4_logfiles.png" src="../_images/ch4_logfiles.png" style="width: 550px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Example of spm12w log and QA file locations after preprocessing.</span><a class="headerlink" href="#ch4-logfiles" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="step-5-estimate-glms">
<h2>Step 5: Estimate GLMs<a class="headerlink" href="#step-5-estimate-glms" title="Permalink to this heading">#</a></h2>
<p>Once the data is preprocessed, the next step is to compute GLMs for each participant. For this we will again use the spm12w GUI.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have a lot of GLMs to compute, it may be useful to enable the Parallel Computing Toolbox in the SPM12w GUI. However, GLMs tend to be quick to compute and so there’s less harm in running them serially.</p>
</div>
<p>Once again, begin by typing <code class="docutils literal notranslate"><span class="pre">spm12w</span></code> in the Matlab command window. You should see the SPM12w GUI appear.</p>
<ol class="arabic simple">
<li><p>Click on the <strong>Estimate GLM</strong> button.</p></li>
<li><p>Select the three tutorial participants and click done.</p></li>
<li><p>Select the glm_tutorial.m file and click done.</p></li>
</ol>
<p>After GLMs are estimated, the location of various logs and figures are printed to the Matlab Command Window along with a summary of the GLM design. This should be inspected for accuracy. See the example below:</p>
<figure class="align-default" id="ch4-glmlogfiles">
<a class="reference internal image-reference" href="../_images/ch4_glmlogfiles.png"><img alt="../_images/ch4_glmlogfiles.png" src="../_images/ch4_glmlogfiles.png" style="width: 550px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 8 </span><span class="caption-text">Example of spm12w log and QA file locations after glm estimation.</span><a class="headerlink" href="#ch4-glmlogfiles" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="step-6-compute-contrasts">
<h2>Step 6: Compute Contrasts<a class="headerlink" href="#step-6-compute-contrasts" title="Permalink to this heading">#</a></h2>
<p>The next step after estimating GLMs is to compute contrats of parameter estimates from the GLM model. This process is the same as the last.</p>
<p>Begin by typing <code class="docutils literal notranslate"><span class="pre">spm12w</span></code> in the Matlab command window. You should see the SPM12w GUI appear.</p>
<ol class="arabic simple">
<li><p>Click on the <strong>Compute Contrasts</strong> button.</p></li>
<li><p>Select the three tutorial participants and click done.</p></li>
<li><p>Select the glm_tutorial.m file and click done.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although estimating GLMs and computing contrasts are seperate steps, they are so intertwined that we combine GLM parameters and contrast parameters into the same file (i.e., glm_tutorial.m) and the SPM12w GUI also contains a button to <em>Estimate and Contrast</em> in a single step.</p>
</div>
<p>After contrasts are computed, single-subject contrasts can be viewed in the derivatives directory specified in the glm file (i.e., <strong>spm-stats-glm_tutorial</strong>)</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>As with the previous steps, it is important to monitor the Matlab Command Window when computing contrasts. SPM12w will display the full contrast vector that it generates from the contrast specification in the GLM parameters file. It is good to check this vector for errors.</p>
</div>
</section>
<section id="step-7-random-effects-analysis">
<h2>Step 7: Random Effects Analysis<a class="headerlink" href="#step-7-random-effects-analysis" title="Permalink to this heading">#</a></h2>
<p>The next step will perform a 2nd-level Random Effects Analysis (RFX) on user specified contrasts. The steps here are the same as in computing contrasts.</p>
<p>Begin by typing <code class="docutils literal notranslate"><span class="pre">spm12w</span></code> in the Matlab command window. You should see the SPM12w GUI appear.</p>
<ol class="arabic simple">
<li><p>Click on the <strong>Random Effects</strong> button.</p></li>
<li><p>Select the three tutorial participants and click done.</p></li>
<li><p>Select the glm_tutorial.m file and click done.</p></li>
</ol>
<p>This will perform a one-sample t-test or a one-way anova (depending on the specifed parameters) for the conditions specified in the <strong>glm_tutorial.m</strong> file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although conducting random effects, estimating GLMs and computing contrasts are seperate steps, the random effects analysis has so few parameters that it doesn’t warrant a seperate file and we specify the RFX conditions and directory inside the glm_tutorial.m file.</p>
</div>
<p>After RFX analysis a summary of the conditions the analysis was performed on, as well as the location of a <em>.mat</em> file saving the parameters of the analysis is printed to the Matlab Command Window. The results of the RFX analysis can be found in the derivatives directory (i.e., <strong>spm-group-stats-rfx_tutorial</strong>)</p>
</section>
<section id="step-8-region-of-interest-roi-analysis">
<h2>Step 8: Region-of-Interest (ROI) Analysis<a class="headerlink" href="#step-8-region-of-interest-roi-analysis" title="Permalink to this heading">#</a></h2>
<p>The final step in the analysis of the tutorial data is to perform an ROI analysis. ROI analyses in spm12w are flexbile and allow for spherical ROI specification as well as image files. In addition, a range of statistics (one and two sample t-tests, correlations, descriptives) etc. can be specified in the ROI file.</p>
<p>As with the previous steps, performing an ROI analysis with the SPM12w GUI requires specifying the subject and the associated parameters file.</p>
<p>Begin by typing <code class="docutils literal notranslate"><span class="pre">spm12w</span></code> in the Matlab command window. You should see the SPM12w GUI appear.</p>
<ol class="arabic simple">
<li><p>Click on the <strong>ROI Analysis</strong> button.</p></li>
<li><p>Select the three tutorial participants and click done.</p></li>
<li><p>Select the roi_tutorial.m file and click done.</p></li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The contrast files used in the analysis as well as informatiuon on the spherical ROI voxel counts of all generated ROIs are printed to the Matlab Command Window. Be sure to check these for accuracy.</p>
</div>
<p>The ROI analysis will outpuit a <em>.csv</em> and <em>.txt</em> file containing the full ROI results and the summary statistics for each ROI. In addition, a <em>.mat</em> file is written containing all the parameters that existed at runtime to be kept as a record of the analysis in case the original roi parameters file is edited or lost.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ch3_parameters.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">SPM12w Parameter Files</p>
      </div>
    </a>
    <a class="right-next"
       href="ch5_examples.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tutorial Walkthrough</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-spm12w-tutorial-dataset">The SPM12w tutorial dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-conversion-from-par-rec">Step 1: Conversion from par/rec</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-prepare-data-and-generate-tsvfiles">Step 2: Prepare data and generate tsvfiles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-validate-the-bids-structure-with-the-bids-validator">Step 3: Validate the BIDS structure with the BIDS validator.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-preprocess-the-fmri-data">Step 4: Preprocess the fMRI data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-estimate-glms">Step 5: Estimate GLMs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-compute-contrasts">Step 6: Compute Contrasts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-7-random-effects-analysis">Step 7: Random Effects Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-8-region-of-interest-roi-analysis">Step 8: Region-of-Interest (ROI) Analysis</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dylan D. Wagner
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>